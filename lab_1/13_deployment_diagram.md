# Диаграмма развертывания

```mermaid
graph LR
    
    subgraph "Клиентский уровень"
        A[Web-клиент]
        B[Мобильное приложение]
    end

    subgraph "Серверный уровень"
        C{Nginx / Reverse Proxy}
        D[Backend-приложение (Node.js)]
        E[(PostgreSQL – база данных)]
        F[(Redis – кэш / сессии)]
        G[(Media-хранилище)]
    end

    subgraph "Внешние системы"
        H[Email-сервис]
        I[WebRTC сервер / STUN/TURN]
    end

    A --> C
    B --> C
    C --> D
    D --> E
    D --> F
    D --> G
    D --> H
    D --> I
```

## Описание

Диаграмма развертывания отражает физическую архитектуру системы видеоконференций и чатов. Она включает клиентские приложения, серверы, хранилища и внешние сервисы, используемые системой.

---

## Компоненты системы

### Клиентский уровень
- **Web-клиент**: Доступ к системе через браузер  
- **Мобильное приложение**: Доступ через мобильное устройство (например, PWA или нативное)

---

### Серверный уровень
- **Nginx / Reverse Proxy**: Распределение входящего трафика, маршрутизация к backend'у  
- **Backend-приложение (Node.js)**: Основная логика работы системы: чаты, конференции, управление пользователями  
- **PostgreSQL**: Реляционная база данных для хранения пользователей, сообщений, чатов и конференций  
- **Redis**: Используется для кэширования, хранения сессий и быстрых операций обмена сообщениями  
- **Media-хранилище**: Файловая система или объектное хранилище для изображений, видео, вложений

---

### Внешние системы
- **Email-сервис**: Для отправки подтверждений, уведомлений и сброса пароля  
- **WebRTC сервер (STUN/TURN)**: Поддержка видеосвязи в режиме реального времени через NAT/firewall

---

## Требования к развертыванию

### Аппаратные требования

#### Сервер приложений:
- CPU: 4+ ядер  
- RAM: 8–16 GB  
- Диск: 100+ GB SSD  

#### Сервер базы данных:
- CPU: 4+ ядер  
- RAM: 16+ GB  
- Диск: 200+ GB SSD  

#### WebRTC сервер:
- CPU: 4+ ядер  
- RAM: 8+ GB  
- Сетевой канал: 100 Mbps+

---

### Программные требования
- **Node.js**: 18.x  
- **PostgreSQL**: 14+  
- **Redis**: 6.x или 7.x  
- **Nginx**: 1.20+  
- **Docker**: 20+  
- **Kubernetes**: 1.23+  
- **Coturn**: для STUN/TURN

---

## Процесс развертывания

### Подготовка окружения
1. Установить Docker и Kubernetes  
2. Настроить k8s-кластер с ingress-контроллером  
3. Создать конфигурации (`.env`, `secrets`, манифесты)

### Развертывание компонентов
1. Развернуть PostgreSQL и Redis  
2. Развернуть backend-приложение  
3. Настроить ingress и Nginx  
4. Подключить media-хранилище  
5. Интеграция с WebRTC и Email

### Настройка мониторинга
1. Установить Prometheus + Grafana  
2. Настроить алерты и метрики  
3. Включить логирование (например, Loki)

---

## Масштабирование

### Горизонтальное масштабирование
- Использование kubernetes deployment с auto-scaling  
- Распределение нагрузки на backend  
- Кэширование Redis и CDN для вложений

### Вертикальное масштабирование
- Увеличение ресурсов узлов (RAM/CPU)  
- Оптимизация SQL-запросов и структуры БД  
- Использование connection pool'ов
