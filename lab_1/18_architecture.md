# Архитектура системы

## Общая архитектура

### Уровни системы
1. **Уровень представления**
   - Веб-клиент (React)
   - Мобильный клиент (React Native / PWA)
   - API-доступ для сторонних систем и интеграций

2. **Бизнес-уровень**
   - Node.js-сервисы
   - Модули видеоконференций, чатов, пользователей и администрирования
   - Внутренние API, логика обработки событий и сообщений

3. **Уровень данных**
   - PostgreSQL (реляционные данные)
   - Redis (кэш и сессии)
   - Хранилище медиафайлов (например, MinIO / S3)
   - Логи событий (ELK)

---

## Компоненты системы

### 1. Модуль пользователей
- Регистрация и вход
- Профиль и личный кабинет
- Статус активности, роли и права
- История активности

### 2. Модуль чатов
- Создание и управление чатами
- Отправка текстовых и медиа-сообщений
- Хранение истории сообщений
- Уведомления и упоминания

### 3. Модуль видеоконференций
- Создание и управление видеовстречами
- WebRTC-сессии, демонстрация экрана
- Управление доступом и кодами конференций
- Встроенный чат для участников

### 4. Модуль администрирования
- Управление пользователями и чатами
- Блокировка, модерация, удаление сообщений
- Назначение ролей
- Журналирование действий

### 5. Модуль логирования и аналитики
- Запись событий (вход, действия, ошибки)
- Аудит действий администраторов
- Интеграция с Prometheus и Grafana
- Метрики посещаемости и активности

---

## Технологический стек

### Frontend
- React
- Next.js
- TypeScript
- TailwindCSS
- WebSocket (real-time)
- Cypress / Playwright

### Backend
- Node.js
- NestJS / Express
- TypeScript
- WebSocket + Redis pub/sub
- Jest, Supertest

### База данных
- PostgreSQL (основная БД)
- Redis (сессии, кэш, очередь событий)
- Prisma ORM / TypeORM

### Инфраструктура
- Docker / Docker Compose
- Kubernetes (k8s)
- Nginx + Certbot
- Prometheus + Grafana
- Loki / ELK Stack
- GitHub Actions / GitLab CI/CD

---

## Безопасность

### Аутентификация
- JWT + Refresh токены
- OAuth 2.0 (Google / GitHub)
- Поддержка 2FA (Google Authenticator)
- Email-подтверждение при регистрации

### Авторизация
- Ролевое управление (RBAC)
- Ограничение доступа к чатам и конференциям
- Защита приватных конференций по коду
- Ограничения по ролям в админ-панели

### Защита данных
- SSL/TLS (HTTPS)
- Шифрование WebRTC (SRTP)
- Хеширование паролей (bcrypt / Argon2)
- WAF и защита от XSS, CSRF, SQL-инъекций

---

## Масштабирование

### Горизонтальное масштабирование
- Балансировка нагрузки на уровне Nginx / ingress  
- Репликация PostgreSQL  
- Redis-кластеры  
- Разделение сервисов по доменам (чаты, видео, админка)

### Вертикальное масштабирование
- Тюнинг PostgreSQL (индексы, партиционирование)  
- Увеличение ресурсов под Node.js / WebRTC  
- Архивация истории сообщений

---

## Мониторинг

### Метрики
- Доступность API и микросервисов  
- Время отклика чата и конференций  
- Кол-во одновременных подключений  
- Ошибки и задержки при отправке сообщений

### Логирование
- Централизованное логирование (Loki / ELK)  
- Трейсинг запросов  
- Аудит действий пользователей и администраторов  
- Настройка алертов по событиям

---

## Интеграция

### Внешние системы
- Email-сервисы (Mailgun / SMTP)
- STUN/TURN-серверы (Coturn)
- Системы логирования (Sentry, Grafana)
- LDAP / SSO (при корпоративной интеграции)

### API
- REST API для внешнего доступа  
- GraphQL для клиентов  
- WebSocket API для real-time взаимодействия  
- Вебхуки для уведомлений и событий
